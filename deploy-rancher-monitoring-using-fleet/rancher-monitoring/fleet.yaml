defaultNamespace: cattle-monitoring-system
targetCustomizations:
- name: AKS
  helm:
    releaseName: rancher-monitoring
    repo: https://charts.rancher.io
    chart: rancher-monitoring
    version: 104.1.0+up57.0.3
    values:
      storage:
        volumeClaimTemplate:
          spec:
            storageClassName: ebs-sc
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 5Gi
      grafana:
        grafana.ini:
          users:
            auto_assign_org_role: Editor
          auth:
            disable_login_form: false
          auth.anonymous:
            enabled: false
            org_role: Editor
          auth.basic:  
            password_policy: true
        persistence: 
          enabled: true
          storageClassName: "managed-csi"
          accessModes:
            - ReadWriteOnce
          size: 1Gi
  clusterSelector:
    matchLabels:
      AKS: true
- name: EKS
  helm:
    releaseName: rancher-monitoring
    repo: https://charts.rancher.io
    chart: rancher-monitoring
    version: 104.1.0+up57.0.3
    values:
      grafana:
        grafana.ini:
          users:
            auto_assign_org_role: Editor
          auth:
            disable_login_form: false
          auth.anonymous:
            enabled: false
            org_role: Editor
          auth.basic:  
            enabled: true
            password_policy: true
        persistence: 
          enabled: true
          storageClassName: "ebs-sc"
          accessModes:
            - ReadWriteOnce
          size: 1Gi
  clusterSelector:
    matchLabels:
      EKS: true
diff:
  comparePatches:
    - apiVersion: admissionregistration.k8s.io/v1
      kind: MutatingWebhookConfiguration
      name: rancher-monitoring-admission
      operations:
        - {"op":"remove", "path":"/webhooks/0/failurePolicy"}
    - apiVersion: admissionregistration.k8s.io/v1
      kind: ValidatingWebhookConfiguration
      name: rancher-monitoring-admission
      operations:
        - {"op":"remove", "path":"/webhooks/0/failurePolicy"}
